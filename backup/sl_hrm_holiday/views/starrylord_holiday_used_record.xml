<?xml version="1.0" encoding="utf-8" ?>

<odoo>
    <data>
        <record id="starrylord_holiday_used_record_form_view" model="ir.ui.view">
            <field name="name">starrylord.holiday.used.record.form</field>
            <field name="model">starrylord.holiday.used.record</field>
            <field name="arch" type="xml">
                <form>
                    <sheet>
                        <group>
							<field name="holiday_apply_name" readonly="1"/>
                            <field name="holiday_allocation_id" readonly="1"/>
                            <field name="employee_id" readonly="1"/>
                            <field name="holiday_apply_id" readonly="1"/>
                            <field name="holiday_day" readonly="1"/>
                            <field name="hours" readonly="1"/>
                            <field name="note" readonly="1"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>
        <record id="starrylord_holiday_used_record_tree_view" model="ir.ui.view">
            <field name="name">starrylord.holiday.used.record.tree</field>
            <field name="model">starrylord.holiday.used.record</field>
            <field name="priority">20</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="employee_id" readonly="1"/>
					<field name="holiday_apply_name" readonly="1"/>
                    <field name="holiday_allocation_id" readonly="1"/>
                    <field name="holiday_day" readonly="1"/>
                    <field name="hours" readonly="1"/>
                    <field name="note" readonly="1"/>
                    <field name="holiday_apply_id" readonly="1"/>
                </tree>
            </field>
        </record>

        <!-- 員工個人查看的 Tree View -->
        <record id="starrylord_holiday_used_record_user_tree_view" model="ir.ui.view">
            <field name="name">starrylord.holiday.used.record.user.tree</field>
            <field name="model">starrylord.holiday.used.record</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="employee_id" readonly="1"/>
					<field name="holiday_apply_name" readonly="1"/>
                    <field name="holiday_allocation_id" readonly="1"/>
                    <field name="holiday_day" readonly="1"/>
                    <field name="hours" readonly="1" sum="總時數"/>
                    <field name="note" readonly="1"/>
                    <field name="holiday_apply_id" readonly="1"/>
                </tree>
            </field>
        </record>

        <record model="ir.actions.act_window" id="starrylord_holiday_used_record_manager_action">
            <field name="name">休假使用對應表</field>
            <field name="res_model">starrylord.holiday.used.record</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{}</field>
        </record>

        <!-- 員工個人休假使用紀錄 -->
        <record model="ir.actions.act_window" id="starrylord_holiday_used_record_user_action">
            <field name="name">我的休假使用紀錄</field>
            <field name="res_model">starrylord.holiday.used.record</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="starrylord_holiday_used_record_user_tree_view"/>
            <field name="domain">[('employee_id.user_id', '=', uid)]</field>
            <field name="context">{}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    目前沒有休假使用紀錄
                </p>
                <p>
                    這裡會顯示您的所有休假使用明細，<br/>
                    包含每次請假對應扣除的休假時數。
                </p>
            </field>
        </record>

        <record id="starrylord_holiday_used_record_search" model="ir.ui.view">
            <field name="name">starrylord.holiday.used.record.search</field>
            <field name="model">starrylord.holiday.used.record</field>
            <field name="arch" type="xml">
                <search string="休假使用紀錄搜尋">
                    <field name="employee_id"/>
                    <field name="holiday_day"/>
                    <field name="holiday_apply_id"/>
                    <field name="holiday_allocation_id"/>
                    <filter string="本月" name="this_month" 
                            domain="[('holiday_day', '&gt;=', (context_today() - relativedelta(day=1)).strftime('%Y-%m-%d')),
                                     ('holiday_day', '&lt;=', (context_today() + relativedelta(day=31)).strftime('%Y-%m-%d'))]"/>
                    <filter string="本年" name="this_year" 
                            domain="[('holiday_day', '&gt;=', time.strftime('%Y-01-01')),
                                     ('holiday_day', '&lt;=', time.strftime('%Y-12-31'))]"/>
                    <separator/>
                    <filter string="依休假類型分組" name="holiday_type_group" domain="[]" context="{'group_by': 'holiday_allocation_id'}" />
                    <filter string="依員工分組" name="employee_id_group" domain="[]" context="{'group_by': 'employee_id'}" />
                    <filter string="依日期分組" name="start_day_group" domain="[]" context="{'group_by': 'holiday_day'}" />
                </search>
            </field>
        </record>

        <record id="starrylord_holiday_used_record_pivot" model="ir.ui.view">
            <field name="name">starrylord.holiday.used.record.pivot</field>
            <field name="model">starrylord.holiday.used.record</field>
            <field name="priority">20</field>
            <field name="arch" type="xml">
                <pivot string="休假使用紀錄分析" sample="1">
                    <field name="employee_info" type="row"/>
                    <field name="holiday_day_format" type="row"/>
                    <field name="holiday_type_id" type="col"/>
                    <field name="hours" type="measure"/>
                </pivot>
            </field>
        </record>

        <record id="starrylord_holiday_used_record_graph" model="ir.ui.view">
            <field name="name">starrylord.holiday.apply.graph</field>
            <field name="model">starrylord.holiday.used.record</field>
            <field name="priority">20</field>
            <field name="arch" type="xml">
                <graph string="休假使用紀錄分析" sample="1">
                    <field name="employee_id"/>
                    <field name="hours" type="measure"/>
                </graph>
            </field>
        </record>

        <record id="starrylord_holiday_used_record_graph_action" model="ir.actions.act_window">
            <field name="name">休假使用紀錄分析</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">starrylord.holiday.used.record</field>
            <field name="view_mode">pivot</field>
            <field name="view_id" ref="starrylord_holiday_used_record_graph"/>
        </record>

        <record id="action_holiday_used_record_wizard" model="ir.actions.act_window">
            <field name="name">休假紀錄報表查詢</field>
            <field name="res_model">holiday.used.record.wizard</field>
            <field name="view_mode">form</field>
            <field name="target">new</field>
        </record>
        
    </data>
</odoo>