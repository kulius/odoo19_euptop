<odoo>
    <record id="starrylord_overtime_apply_tree_view" model="ir.ui.view">
        <field name="name">starrylord.overtime.apply.tree</field>
        <field name="model">starrylord.overtime.apply</field>
        <field name="arch" type="xml">
            <tree decoration-info="state == 'f_approve'" decoration-success="state == 'agree'"
                  decoration-danger="state == 'refused'">
                <field name="state"/>
                <field name="hr_confirm_state" groups="sl_hrm_overtime.group_starrylord_overtime_manager"/>
                <field name="name"/>
                <field name="employee_id"/>
                <field name="start_day"/>
                <field name="apply_from"/>
                <field name="apply_to"/>
                <field name="overtime_type_id"/>
                <field name="duration_time"/>
                <field name="type"/>
                <field name="next_review" optional="show" string="審核階段"/>
            </tree>
        </field>
    </record>

    <record id="starrylord_overtime_apply_form_view" model="ir.ui.view">
        <field name="name">starrylord.overtime.apply.form</field>
        <field name="model">starrylord.overtime.apply</field>
        <field name="arch" type="xml">
            <form>
                <field name="is_readonly" invisible="1"/>
                <field name="can_review" invisible="1"/>
                <header>
                    <field name="hr_confirm_state" widget="statusbar"
                           invisible="state != 'agree'" groups="sl_hrm_overtime.group_starrylord_overtime_manager"/>
                    <field name="state" widget="statusbar"
                           statusbar_visible="draft,f_approve,agree,refused"/>
                    <button name="to_f_approve" string="送出簽核"
                            type="object" class="btn-primary"
                            invisible="state != 'draft'"/>
                    <button name="action_hr_confirm" string="加班確認"
                            type="object" class="btn-primary"
							groups="sl_hrm_overtime.group_starrylord_overtime_manager"
                            invisible="state != 'agree' or hr_confirm_state != 'pending'"/>
                    <button name="action_hr_invalid" string="未符合"
                            type="object" class="btn-danger"
							groups="sl_hrm_overtime.group_starrylord_overtime_manager"
                            invisible="state != 'agree' or hr_confirm_state != 'pending'"/>
                    <!--                    <button string="" name="to_draft" type="object"-->
                    <!--                            invisible="state not in ['f_approve', 'refused']"/>-->
                </header>
                <sheet>
                    <h1>
                        <field name="name" readonly="1"/>
                    </h1>
                    <group>
                        <group>
                            <field name="employee_id" readonly="1"/>
                            <field name="company_id" options="{'no_create':True, 'no_open':True}"/>
                            <field name="job_id" options="{'no_create':True, 'no_open':True}"/>
                        </group>
                        <group>
                            <field name="department_id" options="{'no_create':True, 'no_open':True}"/>
                            <field name="manager_id"/>
                        </group>
                    </group>

                    <group>
                        <group>
                            <field name="start_day" readonly="state != 'draft'"/>
                            <field name="apply_from" invisible="1"/>
                            <field name="apply_to" invisible="1"/>
                            <label for="hour_from"/>
                            <div class="o_row o_row_readonly">
                                <field name="hour_from" readonly="state not in ['draft']"/>
                                <label for="hour_from" string=" : "/>
                                <field name="min_from" readonly="state not in ['draft']" required="1"/>
                            </div>
                            <label for="hour_to"/>
                            <div class="o_row o_row_readonly">
                                <field name="hour_to" readonly="state not in ['draft']"/>
                                <label for="hour_to" string=" : "/>
                                <field name="min_to" readonly="state not in ['draft']" required="1"/>
                            </div>
                            <field name="duration_time" readonly="state != 'draft'" force_save="1"/>
                        </group>
                        <group>
                            <field name="overtime_type_id" widget="selection" options="{'no_create': True, 'no_open': True}" class="w-100"
                                   readonly="1" force_save="1"/>
                            <field name="type" readonly="state != 'draft'"/>
                            <field name="allocation_validity_end" invisible="type != 'holiday'" readonly="1"/>
                            <field name="has_overtime_meal_allowance" invisible="not can_review"/>
                            <field name="without_rest_time"/>
                            <field name="attached" widget="many2many_binary" readonly="state not in ['draft']"/>
                        </group>
                    </group>
                    <group>
                        <field name="desc" widget="text" readonly="state != 'draft'"/>
                        <field name="create_date" string="填單時間" readonly="1"
                                   invisible="create_date == False "/>
                    </group>
                </sheet>
                <!--                <div class="oe_chatter">-->
                <!--                    <field name="message_follower_ids"-->
                <!--                           widget="mail_followers"/>-->
                <!--                    <field name="message_ids" widget="mail_thread"/>-->
                <!--                </div>-->
            </form>
        </field>
    </record>

    <record id="starrylord_overtime_apply_review_form_view" model="ir.ui.view">
        <field name="name">starrylord.overtime.apply.form</field>
        <field name="model">starrylord.overtime.apply</field>
        <field name="arch" type="xml">
            <form>
                <field name="is_readonly" invisible="1"/>
                <field name="can_review" invisible="1"/>
                <header>
                    <field name="state" widget="statusbar"
                           statusbar_visible="draft,f_approve,agree,refused"/>
                </header>
                <sheet>
                    <h1>
                        <field name="name" readonly="1"/>
                    </h1>
                    <group>
                        <group>
                            <field name="employee_id" readonly="1"/>
                            <field name="company_id" options="{'no_create':True, 'no_open':True}"/>
                            <field name="job_id" options="{'no_create':True, 'no_open':True}"/>
                        </group>
                        <group>
                            <field name="department_id" options="{'no_create':True, 'no_open':True}"/>
                            <field name="manager_id"/>
                        </group>
                    </group>

                    <group>
                        <group>
                            <field name="start_day" readonly="state != 'draft'"/>
                            <field name="apply_from" invisible="1"/>
                            <field name="apply_to" invisible="1"/>
                            <label for="hour_from"/>
                            <div class="o_row o_row_readonly">
                                <field name="hour_from" readonly="state not in ['draft']"/>
                                <label for="hour_from" string=" : "/>
                                <field name="min_from" readonly="state not in ['draft']" required="1"/>
                            </div>
                            <label for="hour_to"/>
                            <div class="o_row o_row_readonly">
                                <field name="hour_to" readonly="state not in ['draft']"/>
                                <label for="hour_to" string=" : "/>
                                <field name="min_to" readonly="state not in ['draft']" required="1"/>
                            </div>
                            <field name="duration_time" readonly="state != 'draft'" force_save="1"/>
                        </group>
                        <group>
                            <field name="overtime_type_id" widget="selection" options="{'no_create': True, 'no_open': True}" class="w-100"
                                   readonly="1" force_save="1"/>
                            <field name="type" readonly="state != 'draft'"/>
                            <field name="allocation_validity_end" invisible="type != 'holiday'" readonly="state != 'draft' and type == 'holiday'"/>
                            <field name="has_overtime_meal_allowance" invisible="not can_review"/>
                            <field name="without_rest_time"/>
                            <field name="attached" widget="many2many_binary" readonly="state not in ['draft']"/>
                        </group>
                    </group>
                    <group>
                        <field name="desc" widget="text" readonly="state != 'draft'"/>
                        <field name="create_date" string="填單時間" readonly="1"
                                   invisible="create_date == False "/>
                    </group>
                </sheet>
                <!--                <div class="oe_chatter">-->
                <!--                    <field name="message_follower_ids"-->
                <!--                           widget="mail_followers"/>-->
                <!--                    <field name="message_ids" widget="mail_thread"/>-->
                <!--                </div>-->
            </form>
        </field>
    </record>

    <record id="starrylord_overtime_apply_action" model="ir.actions.act_window">
        <field name="name">我的加班單</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">starrylord.overtime.apply</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('user_id', '=', uid)]</field>
        <field name="view_ids"
               eval="[(5, 0, 0),
                          (0, 0, {'view_mode': 'tree', 'view_id': ref('starrylord_overtime_apply_tree_view')}),
                          (0, 0, {'view_mode': 'form', 'view_id': ref('starrylord_overtime_apply_form_view')})]"/>
    </record>

    <record id="starrylord_overtime_apply_manager_tree_view" model="ir.ui.view">
        <field name="name">starrylord.overtime.apply.tree</field>
        <field name="model">starrylord.overtime.apply</field>
        <field name="arch" type="xml">
            <tree decoration-info="state == 'f_approve'" decoration-success="state == 'agree'"
                  decoration-danger="state == 'refused'">
                <field name="state" column_invisible="1"/>
                <field name="next_review" optional="show" string="審核階段"/>
                <field name="name"/>
                <field name="employee_id"/>
                <field name="start_day"/>
                <field name="overtime_type_id"/>
                <field name="duration_time"/>
            </tree>
        </field>
    </record>

    <record id="starrylord_overtime_apply_manager_form_view" model="ir.ui.view">
        <field name="name">starrylord.overtime.apply.form</field>
        <field name="model">starrylord.overtime.apply</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <field name="hr_confirm_state" widget="statusbar"
                           invisible="state != 'agree'" groups="sl_hrm_overtime.group_starrylord_overtime_manager"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,f_approve,agree,refused"/>
                    <button name="to_f_approve" string="送出簽核" type="object" class="btn-primary"
                            invisible="state not in ['draft']"/>
                    <button name="agree" string="批准" type="object" class="btn-primary"
                            invisible="state not in ['draft']"/>
                    <button name="action_hr_confirm" string="加班確認"
                            type="object" class="btn-primary"
							groups="sl_hrm_overtime.group_starrylord_overtime_manager"
                            invisible="state != 'agree' or hr_confirm_state != 'pending'"/>
                    <button name="action_hr_invalid" string="未符合"
                            type="object" class="btn-danger"
							groups="sl_hrm_overtime.group_starrylord_overtime_manager"
                            invisible="state != 'agree' or hr_confirm_state != 'pending'"/>
                    <button string="重置為草稿" name="to_draft" type="object"
                            invisible="state not in ['agree','refused']"/>
                </header>
                <sheet>
                    <h2>

                    </h2>
                    <h1>
                        <field name="name" readonly="1"/>
                    </h1>
                    <group>
                        <group>
                            <field name="employee_id" readonly="state in ['agree', 'f_approve']"/>
                            <field name="company_id" options="{'no_create':True, 'no_open':True}"/>
                            <field name="job_id"/>
                        </group>
                        <group>
                            <field name="department_id" options="{'no_create':True, 'no_open':True}"/>
                            <field name="manager_id"/>
                        </group>
                    </group>

                    <group>
                        <group>
                            <field name="start_day" readonly="state == 'agree'"/>
                            <field name="apply_from" invisible="1"/>
                            <field name="apply_to" invisible="1"/>
                            <label for="hour_from"/>
                            <div class="o_row o_row_readonly">
                                <field name="hour_from" readonly="state == 'agree'"/>
                                <label for="hour_from" string=" : "/>
                                <field name="min_from" readonly="state == 'agree'" required="1"/>
                            </div>
                            <label for="hour_to"/>
                            <div class="o_row o_row_readonly">
                                <field name="hour_to" readonly="state == 'agree'"/>
                                <label for="hour_to" string=" : "/>
                                <field name="min_to" readonly="state == 'agree'" required="1"/>
                            </div>
                            <field name="duration_time" readonly="state == 'agree'" force_save="1"/>
                        </group>
                        <group>
                            <field name="overtime_type_id" widget="selection" options="{'no_create': True, 'no_open': True}" class="w-100"
                                   readonly="1" force_save="1"/>
                            <field name="type" readonly="state != 'draft'"/>
                            <field name="allocation_validity_end" invisible="type != 'holiday'" readonly="1"/>
                            <field name="has_overtime_meal_allowance" readonly="state == 'agree'"/>
                            <field name="without_rest_time" readonly="state == 'agree'"/>
                            <field name="attached" widget="many2many_binary" readonly="state == 'agree'"/>
                        </group>
                    </group>
                    <group>
                        <field name="desc" widget="text" readonly="state == 'agree'"/>
                        <field name="create_date" string="填單時間" readonly="1"
                                   invisible="create_date == False "/>
                    </group>
                </sheet>
                <!--                <div class="oe_chatter">-->
                <!--                    <field name="message_follower_ids"-->
                <!--                           widget="mail_followers"/>-->
                <!--                    <field name="message_ids" widget="mail_thread"/>-->
                <!--                </div>-->
            </form>
        </field>
    </record>

    <record id="starrylord_overtime_apply_manager_search" model="ir.ui.view">
        <field name="name">starrylord.overtime.apply.manager.search</field>
        <field name="model">starrylord.overtime.apply</field>
        <field name="arch" type="xml">
            <search string="加班管理搜尋">
                <field name="name"/>
                <field name="employee_id"/>
                <field name="department_id"/>
                <field name="manager_id"/>
                <field name="start_day"/>
                <field name="type"/>
                <field name="overtime_type_id"/>
                <filter string="員工分組" name="employee_id_group" domain="[]" context="{'group_by': 'employee_id'}"/>
                <filter string="上月記錄" name="this_month" domain="[('start_day', '&gt;=', (context_today() - relativedelta(months=1) + relativedelta(day=1))), ('start_day', '&lt;=', (context_today()+ relativedelta(day=1)-relativedelta(days=1)))]"/>
                <filter string="本月記錄" name="this_month" domain="[('start_day', '&gt;=', context_today() + relativedelta(day=1)), ('start_day', '&lt;', context_today() + relativedelta(day=1, month=context_today().month + 1))]"/>
            </search>
        </field>
    </record>

    <record id="starrylord_overtime_apply_manager_action" model="ir.actions.act_window">
        <field name="name">加班管理</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">starrylord.overtime.apply</field>
        <field name="view_mode">tree,form</field>
        <field name="search_view_id" ref="starrylord_overtime_apply_manager_search"/>
        <field name="view_ids"
               eval="[(5, 0, 0),
                          (0, 0, {'view_mode': 'tree', 'view_id': ref('starrylord_overtime_apply_tree_view')}),
                          (0, 0, {'view_mode': 'form', 'view_id': ref('starrylord_overtime_apply_manager_form_view')})]"/>
        <field name="context"></field>
    </record>
    <record id="starrylord_overtime_apply_pivot" model="ir.ui.view">
        <field name="name">starrylord.overtime.apply.pivot</field>
        <field name="model">starrylord.overtime.apply</field>
        <field name="priority">20</field>
        <field name="arch" type="xml">
            <pivot string="加班申請紀錄分析報表" sample="1">
                <field name="employee_info" type="row"/>
                <field name="start_day_format" type="row"/>
                <field name="overtime_type_id" type="col"/>
                <field name="type" type="col"/>
                <field name="duration_time" type="measure"/>
            </pivot>
        </field>
    </record>

    <record id="starrylord_overtime_apply_report_action" model="ir.actions.act_window">
        <field name="name">加班申請紀錄分析</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">starrylord.overtime.apply</field>
        <field name="view_mode">pivot</field>
        <field name="view_id" ref="starrylord_overtime_apply_pivot"/>
    </record>

    <record id="view_overtime_apply_portal_todo" model="ir.ui.view">
        <field name="name">starrylord.overtime.apply.portal.tree</field>
        <field name="model">starrylord.overtime.apply</field>
        <field name="arch" type="xml">
            <tree>
                <field name="state"/>
                <field name="company_id"/>
                <field name="name"/>
                <field name="employee_id"/>
                <field name="start_day"/>
                <field name="apply_from"/>
                <field name="apply_to"/>
                <field name="overtime_type_id"/>
                <field name="duration_time"/>
            </tree>
        </field>
    </record>

    <record id="action_overtime_apply_portal_todo" model="ir.actions.act_window">
        <field name="name">加班單審核</field>
        <field name="res_model">starrylord.overtime.apply</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('can_review','=',True)]</field>
        <field name="context">{'edit': 1,'create': 0}</field>
        <field name="view_ids"
               eval="[(5, 0, 0),
                          (0, 0, {'view_mode': 'tree', 'view_id': ref('view_overtime_apply_portal_todo')}),
                          (0, 0, {'view_mode': 'form', 'view_id': ref('starrylord_overtime_apply_review_form_view')})]"/>
<!--        <field name="view_id" ref="view_overtime_apply_portal_todo"/>-->
    </record>

</odoo>